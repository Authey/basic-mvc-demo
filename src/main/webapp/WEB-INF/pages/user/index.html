<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User</title>
</head>
<body>
    <table>
        <tr><td><div>${type!}</div></td></tr>
        <tr><td><div id="user-alert"></div></td></tr>
    </table>
    <table>
        <tr>
            <td><label for="username">Username:</label></td>
            <td colspan="2"><input type="text" id="username"></td>
        </tr>
        <#if type != 'Manage'>
            <tr>
                <td><label for="password">Password:</label></td>
                <td colspan="2"><input type="password" id="password"></td>
            </tr>
        </#if>
        <tr>
            <#if type == 'Login'>
                <td><button onclick="login()">Log In</button></td>
            <#elseif type == 'Enroll'>
                <td><button onclick="enroll()">Enroll</button></td>
            <#elseif type == 'Manage'>
                <td><button onclick="load()">Load User</button></td>
                <td><button onclick="remove()">Remove</button></td>
            </#if>
            <td><button onclick="toHome()">Home</button></td>
        </tr>
    </table>
    <table id="user-info"></table>
    <div id="user-page"></div>
</body>
</html>

<#include "*/resources.html" />

<script type="text/javascript">
    function login() {
        let username = $("#username").val();
        let password = $("#password").val();
        $.ajax({
            type: "POST",
            url: "${root!}/user/login",
            async: false,
            data: {"username": username, "password": password},
            dataType: "json",
            success: function(msg) {
                if (eval(msg).state === 1) {
                    toHome()
                } else {
                    $("#user-alert").html(JSON.stringify(msg))
                }
            }
        })
    }

    function enroll() {
        let username = $("#username").val();
        let password = $("#password").val();
        $.ajax({
            type: "POST",
            url: "${root!}/user/enroll",
            async: false,
            data: {"username": username, "password": password},
            dataType: "json",
            success: function(msg) {
                if (eval(msg).state === 1) {
                    window.location.href = "${root!}/user/index";
                } else {
                    $("#user-alert").html(JSON.stringify(msg))
                }
            },
        })
    }

    function load() {
        jQuery("#user-info").jqGrid({
            url: "${root!}/user/load",
            datatype: "json",
            mtype: "POST",
            colNames: ['ID', 'USERNAME', 'PASSWORD', 'AUTH LEVEL'],
            colModel: [
                {name: 'ID', index: 'ID', hidden: true, align: 'center', width: 10},
                {name: 'USERNAME', index: 'USERNAME', hidden: false, align: 'center', width: 30},
                {name: 'PASSWORD', index: 'PASSWORD', hidden: false, align: 'center', width: 30},
                {name: 'AUTH_LEVEL', index: 'AUTH_LEVEL', hidden: false, align: 'center', width: 30},
            ],
            rownum: 10,
            pager: "#user-page",
            rownumbers: true,
            autoheight: true,
            autowidth: true,
            subGrid: false,
        })
    }

    function remove() {
        let username = $("#username").val();
        $.ajax({
            type: "POST",
            url: "${root!}/user/remove",
            async: false,
            data: {"username": username},
            dataType: "json",
            success: function(msg) {
                $("#user-alert").html(JSON.stringify(msg))
            }
        })
    }

    function toHome() {
        window.location.href = "${root!}/home"
    }
</script>